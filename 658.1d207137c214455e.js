"use strict";(self.webpackChunkmy_sw=self.webpackChunkmy_sw||[]).push([[658],{3658:(me,S,a)=>{a.r(S),a.d(S,{routes:()=>ge});var l=a(6895),P=a(5698),n=a(8274),u=a(5861),z=a(9635),h=a(3900),p=a(2076),F=a(1135),I=a(727);class O extends I.w0{constructor(r,e){super()}schedule(r,e=0){return this}}const k={setInterval(o,r,...e){const{delegate:t}=k;return t?.setInterval?t.setInterval(o,r,...e):setInterval(o,r,...e)},clearInterval(o){const{delegate:r}=k;return(r?.clearInterval||clearInterval)(o)},delegate:void 0};var M=a(8737);const L={now:()=>(L.delegate||Date).now(),delegate:void 0};class g{constructor(r,e=g.now){this.schedulerActionCtor=r,this.now=e}schedule(r,e=0,t){return new this.schedulerActionCtor(this,r).schedule(t,e)}}g.now=L.now;const j=new class G extends g{constructor(r,e=g.now){super(r,e),this.actions=[],this._active=!1}flush(r){const{actions:e}=this;if(this._active)return void e.push(r);let t;this._active=!0;do{if(t=r.execute(r.state,r.delay))break}while(r=e.shift());if(this._active=!1,t){for(;r=e.shift();)r.unsubscribe();throw t}}}(class $ extends O{constructor(r,e){super(r,e),this.scheduler=r,this.work=e,this.pending=!1}schedule(r,e=0){var t;if(this.closed)return this;this.state=r;const i=this.id,s=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(s,i,e)),this.pending=!0,this.delay=e,this.id=null!==(t=this.id)&&void 0!==t?t:this.requestAsyncId(s,this.id,e),this}requestAsyncId(r,e,t=0){return k.setInterval(r.flush.bind(r,this),t)}recycleAsyncId(r,e,t=0){if(null!=t&&this.delay===t&&!1===this.pending)return e;null!=e&&k.clearInterval(e)}execute(r,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const t=this._execute(r,e);if(t)return t;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(r,e){let i,t=!1;try{this.work(r)}catch(s){t=!0,i=s||new Error("Scheduled action threw falsy error")}if(t)return this.unsubscribe(),i}unsubscribe(){if(!this.closed){const{id:r,scheduler:e}=this,{actions:t}=e;this.work=this.state=this.scheduler=null,this.pending=!1,(0,M.P)(t,this),null!=r&&(this.id=this.recycleAsyncId(e,r,null)),this.delay=null,super.unsubscribe()}}});var b=a(4482),_=a(5403),N=a(4671);function Q(o,r){return o===r}var C=a(2843),x=a(9646),v=a(4004),q=a(3099),m=a(8959);function Z(o){const r=new Uint32Array(o/2);return crypto.getRandomValues(r),Array.from(r,e=>("0"+e.toString(16)).slice(-2)).join("")}function w(){return(w=(0,u.Z)(function*(o){const e=(new TextEncoder).encode(o);return crypto.subtle.digest("SHA-256",e)})).apply(this,arguments)}var E=a(529),d=a(3889);const R="https://oauth2.googleapis.com/token",A="google-token",T="google-state-";let D=(()=>{class o{constructor(e,t,i,s){this.configuration=e,this.storage=t,this.http=i,this.router=s,this.storeTokenDataPipe=(0,z.z)((0,h.w)(c=>(0,p.D)(this.storeTokenData(c)))),this.tokenReadySubject=new F.X(null),this.tokenRead$=this.tokenReadySubject.asObservable().pipe(function Y(o,r=j){return(0,b.e)((e,t)=>{let i=null,s=null,c=null;const y=()=>{if(i){i.unsubscribe(),i=null;const f=s;s=null,t.next(f)}};function ve(){const f=c+o,U=r.now();if(U<f)return i=this.schedule(void 0,f-U),void t.add(i);y()}e.subscribe((0,_.x)(t,f=>{s=f,c=r.now(),i||(i=r.schedule(ve,o),t.add(i))},()=>{y(),t.complete()},void 0,()=>{s=i=null}))})}(100),function B(o,r=N.y){return o=o??Q,(0,b.e)((e,t)=>{let i,s=!0;e.subscribe((0,_.x)(t,c=>{const y=r(c);(s||!o(i,y))&&(s=!1,i=y,t.next(c))}))})}()),this.getAvailbleTokenData().then(c=>{console.debug(c),null===this.tokenReadySubject.value&&this.tokenReadySubject.next("none"!==c.type)})}storeTokenData(e){var t=this;return(0,u.Z)(function*(){const i=Date.now(),s={...e},c=yield t.loadTokenData();return!s.refresh_token&&c?.refresh_token&&(s.refresh_token=c.refresh_token),void 0===s.expiredAt&&(s.expiredAt=i+1e3*s.expires_in-1e4),yield t.storage.storeData(A,s),t.tokenReadySubject.next(!0),s})()}loadTokenData(){var e=this;return(0,u.Z)(function*(){return e.storage.loadData(A)})()}removeTokenData(){var e=this;return(0,u.Z)(function*(){yield e.storage.removeData(A),e.tokenReadySubject.next(!1)})()}storeState(e,t){var i=this;return(0,u.Z)(function*(){const s=Date.now(),c={...t};return void 0===c.expiredAt&&(c.expiredAt=s+6e5),yield i.storage.storeData(`${T}${e}`,c),c})()}loadState(e){var t=this;return(0,u.Z)(function*(){const i=Date.now();for(const s of yield t.storage.loadKeys())console.debug(s),s.startsWith(T)&&((yield t.storage.loadData(s))?.expiredAt??0)<i&&(yield t.storage.removeData(s));return console.debug(e),t.storage.loadData(`${T}${e}`)})()}removestate(e){var t=this;return(0,u.Z)(function*(){const i=yield t.loadState(e);return console.debug(i),yield t.storage.removeData(`${T}${e}`),i})()}refreshTokenData(e){return this.http.post(R,{client_id:this.configuration.client_id,client_secret:this.configuration.client_secret,grant_type:"refresh_token",refresh_token:e}).pipe(this.storeTokenDataPipe)}exchangeCodeForToken(e,t,i){return(0,p.D)(this.removestate(t)).pipe((0,h.w)(s=>i?(0,C._)(()=>i):(0,x.of)(s)),(0,h.w)(s=>s?this.http.post(R,{client_id:this.configuration.client_id,client_secret:this.configuration.client_secret,code:e,code_verifier:s.verifierCode,grant_type:"authorization_code",redirect_uri:this.configuration.redirect_uri}).pipe(this.storeTokenDataPipe,(0,v.U)(()=>s)):(0,C._)(()=>new m.YP(t))))}getAuthorizationURL(){const e=Z(56);return(0,p.D)(function H(o){return w.apply(this,arguments)}(e)).pipe((0,v.U)(t=>function J(o,r=!1){let e="";const t=new Uint8Array(o),i=t.byteLength;for(let c=0;c<i;c++)e+=String.fromCharCode(t[c]);const s=btoa(e);return r?function K(o){return o.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}(s):s}(t,!0)),(0,h.w)(t=>{const i=Z(16);return(0,p.D)(this.storeState(i,{verifierCode:e,redirectUrl:this.router.url})).pipe((0,v.U)(()=>({challengeCode:t,securityToken:i})))}),(0,v.U)(({challengeCode:t,securityToken:i})=>{const s=new URL("https://accounts.google.com/o/oauth2/v2/auth");return s.searchParams.set("client_id",this.configuration.client_id),s.searchParams.set("redirect_uri",this.configuration.redirect_uri),s.searchParams.set("response_type","code"),s.searchParams.set("scope",this.configuration.scopes.join(" ")),s.searchParams.set("code_challenge",t),s.searchParams.set("code_challenge_method","S256"),s.searchParams.set("state",new URLSearchParams({security_token:i}).toString()),s.searchParams.append("prompt","consent"),s.searchParams.append("access_type","offline"),s}))}getAvailbleTokenData(){var e=this;return(0,u.Z)(function*(){const t=yield e.loadTokenData(),i=Date.now();if(t){if(console.debug(t,t.expiredAt,t.expiredAt??0,(t.expiredAt??0)>i),(t.expiredAt??0)>i)return{type:"allowed",tokenData:t};if(t.refresh_token)return{type:"refresh",refreshToken:t.refresh_token}}return{type:"none"}})()}tryLoadingTokenData(){return(0,p.D)(this.getAvailbleTokenData()).pipe((0,h.w)(e=>"none"===e.type?(0,x.of)(null):"allowed"===e.type?(0,x.of)(e.tokenData):this.refreshTokenData(e.refreshToken)),(0,q.B)())}getAccessToken(){return(0,p.D)(this.tryLoadingTokenData()).pipe((0,v.U)(e=>e?.access_token??null))}getAuthorizationHeader(){return(0,p.D)(this.tryLoadingTokenData()).pipe((0,h.w)(e=>e?(0,x.of)(`${e.token_type} ${e.access_token}`):(0,C._)(()=>new m.kG)))}forceExpired(){var e=this;return(0,u.Z)(function*(){const t=yield e.loadTokenData();t&&(t.expiredAt=0)})()}deleteToken(){var e=this;return(0,u.Z)(function*(){return e.removeTokenData()})()}}return o.\u0275fac=function(e){return new(e||o)(n.LFG(m.tL),n.LFG(m.M3),n.LFG(E.eN),n.LFG(d.F0))},o.\u0275prov=n.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})(),ne=(()=>{class o{constructor(e,t,i){this.tokenService=e,this.route=t,this.router=i,this.errorMessage=null}ngOnInit(){console.debug("xxxxx");const e=this.route.snapshot.queryParams,t=e.code,i=new URLSearchParams(e.state).get("security_token");t&&i&&this.tokenService.exchangeCodeForToken(t,i,e.error).pipe((0,P.q)(1)).subscribe({next:s=>{this.router.navigateByUrl(s.redirectUrl)},error:s=>{this.errorMessage=s.error?.error?s.error?.error:s instanceof Error?s.message:s}})}}return o.\u0275fac=function(e){return new(e||o)(n.Y36(D),n.Y36(d.gz),n.Y36(d.F0))},o.\u0275cmp=n.Xpm({type:o,selectors:[["app-authorization-page"]],standalone:!0,features:[n.jDz],decls:2,vars:1,template:function(e,t){1&e&&(n.TgZ(0,"p"),n._uU(1),n.qZA()),2&e&&(n.xp6(1),n.Oqu(t.errorMessage))},dependencies:[l.ez]}),o})();function oe(o,r){if(1&o&&(n.TgZ(0,"div",1)(1,"div"),n._uU(2),n.qZA(),n.TgZ(3,"div"),n._uU(4),n.qZA()()),2&o){const e=r.$implicit,t=n.oxw();n.xp6(2),n.Oqu(e.summary),n.xp6(2),n.Oqu(t.displayEventTimeRange(e))}}let re=(()=>{class o{constructor(){this.displayEventTimeRange=m.sr}ngOnInit(){if(!this.data)throw new Error("Property 'data' is required")}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=n.Xpm({type:o,selectors:[["google-events-list"]],inputs:{data:"data"},standalone:!0,features:[n.jDz],decls:1,vars:1,consts:[["class","sc",4,"ngFor","ngForOf"],[1,"sc"]],template:function(e,t){1&e&&n.YNc(0,oe,5,2,"div",0),2&e&&n.Q6J("ngForOf",t.data.items)},dependencies:[l.ez,l.sg],styles:[".sc[_ngcontent-%COMP%]{text-align:center}"]}),o})();var se=a(8505);let ae=(()=>{class o{constructor(e,t){this.tokenService=e,this.http=t}getAll(e){return console.debug("getAll"),this.tokenService.getAuthorizationHeader().pipe((0,h.w)(t=>this.http.get("https://www.googleapis.com/calendar/v3/calendars/primary/events",{headers:{authorization:t},params:e})))}}return o.\u0275fac=function(e){return new(e||o)(n.LFG(D),n.LFG(E.eN))},o.\u0275prov=n.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();function ce(o,r){1&o&&n._UZ(0,"google-events-list",2),2&o&&n.Q6J("data",r.ngIf)}function le(o,r){1&o&&(n.TgZ(0,"div"),n._uU(1," loading... "),n.qZA())}let ue=(()=>{class o{constructor(e){this.dataService=e,this.data$=this.dataService.getAll().pipe((0,se.b)(t=>console.debug("xxxxxx",t)))}}return o.\u0275fac=function(e){return new(e||o)(n.Y36(ae))},o.\u0275cmp=n.Xpm({type:o,selectors:[["google-events-list-page"]],standalone:!0,features:[n.jDz],decls:4,vars:4,consts:[[3,"data",4,"ngIf","ngIfElse"],["loading",""],[3,"data"]],template:function(e,t){if(1&e&&(n.YNc(0,ce,1,1,"google-events-list",0),n.ALo(1,"async"),n.YNc(2,le,2,0,"ng-template",null,1,n.W1O)),2&e){const i=n.MAs(3);n.Q6J("ngIf",n.lcZ(1,2,t.data$))("ngIfElse",i)}},dependencies:[l.ez,l.O5,l.Ov,re]}),o})();function he(o,r){if(1&o){const e=n.EpF();n.ynx(0),n.TgZ(1,"div")(2,"button",3),n.NdJ("click",function(){n.CHM(e);const i=n.oxw();return n.KtG(i.onForceExpired)}),n._uU(3," Force Expired "),n.qZA(),n.TgZ(4,"button",4),n._uU(5," Delete Token "),n.qZA()(),n._UZ(6,"router-outlet"),n.BQk()}}function pe(o,r){if(1&o){const e=n.EpF();n.ynx(0),n.TgZ(1,"button",3),n.NdJ("click",function(){n.CHM(e);const i=n.oxw();return n.KtG(i.onLogin())}),n._uU(2,"Login to Goole"),n.qZA(),n.BQk()}}function fe(o,r){1&o&&(n.TgZ(0,"div"),n._uU(1,"Loading..."),n.qZA())}const ge=[{path:"",component:(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=n.Xpm({type:o,selectors:[["google-root"]],standalone:!0,features:[n.jDz],decls:7,vars:0,consts:[[1,"cmp-"],[1,"button","button4"],["href","","routerLink","events","routerLinkActive","st-active"]],template:function(e,t){1&e&&(n.TgZ(0,"nav")(1,"ul",0)(2,"li")(3,"button",1)(4,"a",2),n._uU(5,"Events"),n.qZA()()()()(),n._UZ(6,"router-outlet"))},dependencies:[l.ez,d.Bz,d.lC,d.rH,d.Od],styles:['@import"https://fonts.googleapis.com/css2?family=Montserrat:wght@200&display=swap";h1[_ngcontent-%COMP%]{color:#ffe81f;font-weight:1000}h1[_ngcontent-%COMP%], li[_ngcontent-%COMP%]{font-family:Montserrat;font-weight:bolder;text-align:center}li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;color:#ffe81f}li[_ngcontent-%COMP%]{list-style:none;display:inline;padding-right:30px;text-align:center}.nav[_ngcontent-%COMP%]{text-align:center}ul[_ngcontent-%COMP%]{text-align:center;padding-top:30px}.button[_ngcontent-%COMP%]{background-color:#34a853;border:none;color:#fff;padding:20px;text-align:center;text-decoration:none;display:inline-block;font-size:16px;margin:4px 2px}.button4[_ngcontent-%COMP%]{border-radius:20px}']}),o})(),children:[{path:"",redirectTo:"events",pathMatch:"full"},{path:"",component:(()=>{class o{constructor(e){this.tokenSerivce=e,this.tokenReady$=this.tokenSerivce.tokenRead$}onForceExpired(){var e=this;return(0,u.Z)(function*(){return e.tokenSerivce.forceExpired()})()}onLogin(){this.tokenSerivce.getAuthorizationURL().pipe((0,P.q)(1)).subscribe(e=>{console.debug(e),location.href=`${e}`})}}return o.\u0275fac=function(e){return new(e||o)(n.Y36(D))},o.\u0275cmp=n.Xpm({type:o,selectors:[["google-require-token"]],standalone:!0,features:[n.jDz],decls:5,vars:5,consts:[[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],["type","button",3,"click"],["type","button"]],template:function(e,t){1&e&&(n.ynx(0,0),n.ALo(1,"async"),n.YNc(2,he,7,0,"ng-container",1),n.YNc(3,pe,3,0,"ng-container",1),n.YNc(4,fe,2,0,"div",2),n.BQk()),2&e&&(n.Q6J("ngSwitch",n.lcZ(1,3,t.tokenReady$)),n.xp6(2),n.Q6J("ngSwitchCase",!0),n.xp6(1),n.Q6J("ngSwitchCase",!1))},dependencies:[l.ez,l.RF,l.n9,l.ED,l.Ov,d.Bz,d.lC]}),o})(),children:[{path:"events",component:ue}]},{path:"authorization",component:ne}]}]}}]);